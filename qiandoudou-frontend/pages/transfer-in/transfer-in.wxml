<!--pages/transfer-in/transfer-in.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="top-nav">
    <view class="nav-left">
      <view class="back-btn" bindtap="goBack">
        <text class="back-arrow">â€¹</text>
      </view>
    </view>
    <view class="nav-center">
      <text class="nav-title">è½¬å…¥</text>
    </view>
    <view class="nav-right"></view>
  </view>

  <!-- é¡µç­¾åˆ‡æ¢ -->
  <view class="tab-section">
    <view class="tab-item {{activeTab === 'direct' ? 'active' : ''}}" bindtap="switchTab" data-tab="direct">
      <text class="tab-text">ç›´æ¥è½¬å…¥</text>
    </view>
    <view class="tab-item {{activeTab === 'auto' ? 'active' : ''}}" bindtap="switchTab" data-tab="auto">
      <text class="tab-text">è‡ªåŠ¨æ”’</text>
    </view>
  </view>

  <!-- ç›´æ¥è½¬å…¥é¡µé¢ -->
  <view wx:if="{{activeTab === 'direct'}}" class="direct-transfer">
    <!-- è½¬å‡ºé‡‘é¢å¡ç‰‡ -->
    <view class="amount-card">
      <view class="card-header">
        <text class="card-title">è½¬å…¥é‡‘é¢</text>
        <!-- ç§»é™¤å…³é—­æŒ‰é’® -->
      </view>
      <view class="amount-input-section">
        <text class="currency-symbol">Â¥</text>
        <input class="amount-input" 
               type="digit" 
               placeholder="è¯·è¾“å…¥é‡‘é¢" 
               value="{{transferAmount}}" 
               bindinput="onAmountInput"
               focus="{{amountFocus}}" />
      </view>
    </view>

    <!-- å¤‡æ³¨å¡ç‰‡ -->
    <view class="note-card">
      <view class="note-header">
        <text class="note-title">å¤‡æ³¨</text>
      </view>
      <view class="note-content">
        <textarea class="note-textarea" 
                  placeholder="å±±é«˜æ°´é•¿ï¼Œé£æ™¯ç¾å¦‚ç”»ã€‚åç­‰ä»™å¥³ä¸‹å‡¡ï¼Œèµäºˆæˆ‘ä¸€ç‰‡äº‘å½©ï¼Œå¥½é£åˆ°æ¹–é‡Œæ³¡ä¸ªæ¾¡ï¼"
                  value="{{transferNote}}"
                  bindinput="onNoteInput"
                  maxlength="200"></textarea>
        <view class="note-actions">
          <view class="retry-btn" bindtap="retryNote">
            <text class="retry-icon">ğŸ”„</text>
            <text class="retry-text">å†è¯•ä¸€æ¬¡</text>
          </view>
          <text class="char-count">{{noteLength}}/200</text>
        </view>
        
        <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
        <view class="image-upload-section">
          <view wx:if="{{!uploadedImage}}" class="upload-placeholder" bindtap="uploadImage">
            <text class="upload-icon">ğŸ“·</text>
          </view>
          <view wx:else class="uploaded-image">
            <image class="note-image" src="{{uploadedImage}}" mode="aspectFill"></image>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è‡ªåŠ¨æ”’é¡µé¢ -->
  <view wx:if="{{activeTab === 'auto'}}" class="auto-save">
    <!-- æ”’é’±æ–¹å¼ -->
    <view class="setting-card">
      <view class="setting-row" bindtap="showSaveMethodOptions">
        <text class="setting-label">æ”’é’±æ–¹å¼</text>
        <view class="setting-value">
          <text class="value-text">{{autoSaveSettings.method}}</text>
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>

    <!-- é‡‘é¢è®¾ç½® -->
    <view class="setting-card">
      <view class="setting-row" bindtap="showAmountOptions">
        <text class="setting-label">é‡‘é¢</text>
        <view class="setting-value">
          <text class="value-text">{{autoSaveSettings.amount}}å…ƒ</text>
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>

    <!-- æ”’å¤šä¹… -->
    <view class="setting-card">
      <view class="setting-row" bindtap="showDurationOptions">
        <text class="setting-label">æ”’å¤šä¹…</text>
        <view class="setting-value">
          <text class="value-text">{{autoSaveSettings.duration}}</text>
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>

    <!-- æ”’é’±æ–¹å¼è¯´æ˜ -->
    <view class="setting-card">
      <view class="setting-row-static">
        <text class="setting-label">æ”’é’±æ–¹å¼</text>
        <view class="setting-value">
          <text class="value-text gray">{{autoSaveSettings.startTime}}</text>
        </view>
      </view>
    </view>

    <!-- æ‰£æ¬¾æ–¹å¼ -->
    <view class="setting-card">
      <view class="setting-row" bindtap="showPaymentOptions">
        <text class="setting-label">æ‰£æ¬¾æ–¹å¼</text>
        <view class="setting-value">
          <text class="value-text">{{autoSaveSettings.paymentMethod}}</text>
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>

    <!-- æ”¶ç›Šé¢„ä¼° -->
    <view class="estimate-card">
      <text class="estimate-text">æ¯æ—¥æ”’<text class="highlight">{{autoSaveSettings.amount}}å…ƒ</text> ä¸€å¹´åå¤§çº¦å¯æ”’<text class="highlight orange">{{estimatedAmount}}å…ƒ</text></text>
    </view>

    <!-- è®¡åˆ’å¤‡æ³¨ -->
    <view class="plan-note-section">
      <text class="section-title">è®¡åˆ’å¤‡æ³¨</text>
      <input class="plan-input" 
             placeholder="è®¡åˆ’åç§°(éå¿…å¡«ï¼Œä¸è¶…è¿‡15ä¸ªå­—)"
             value="{{planName}}"
             bindinput="onPlanNameInput"
             maxlength="15" />
      
      <view class="theme-buttons">
        <view class="theme-btn {{selectedTheme === 'custom' ? 'active' : ''}}" bindtap="selectTheme" data-theme="custom">
          <text class="theme-text">è‡ªå®šä¹‰</text>
        </view>
        <view class="theme-btn {{selectedTheme === 'preset' ? 'active' : ''}}" bindtap="selectTheme" data-theme="preset">
          <text class="theme-text">åŠ æ²¹ä¸»é¢˜</text>
        </view>
      </view>

      <view class="agreement-section">
        <text class="agreement-text">æŸ¥çœ‹ã€Šå¹³å®‰é“¶è¡Œé’±å…œå…œè‡ªåŠ¨æ”’åè®®ã€‹</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨ç¡®è®¤æŒ‰é’® -->
  <view class="bottom-action">
    <button class="confirm-btn" 
            bindtap="confirmTransfer" 
            disabled="{{transferLoading}}">
      <text class="btn-text">{{transferLoading ? 'å¤„ç†ä¸­...' : (activeTab === 'auto' ? 'åŒæ„åè®® ç«‹å³å¼€å¯' : 'ç¡®è®¤è½¬å…¥')}}</text>
    </button>
  </view>
</view>
